<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>3D Coin Collector</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    /* HUD – licznik monet */
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 20px;
      font-family: Arial, sans-serif;
      z-index: 10;
    }
    /* Menu główne i sklep */
    #menu, #shop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-family: Arial, sans-serif;
      z-index: 20;
    }
    .menu-button {
      padding: 10px 20px;
      margin: 10px;
      background: #333;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
    .menu-button:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <div id="hud">Monety: 0</div>

  <div id="menu">
    <h1>3D Coin Collector</h1>
    <button id="startButton" class="menu-button">Start</button>
    <button id="shopButton" class="menu-button">Sklep</button>
  </div>

  <div id="shop" style="display:none;">
    <h1>Sklep</h1>
    <p>Kup ulepszenie prędkości (koszt: 5 monet)</p>
    <button id="buySpeed" class="menu-button">Kup</button>
    <p id="shopMessage"></p>
    <button id="backButton" class="menu-button">Powrót</button>
  </div>

  <!-- Importujemy Three.js oraz kontrolki z lokalnych plików -->
  <script type="module">
    import * as THREE from './js/three.module.js';
    import { PointerLockControls } from './js/controls/PointerLockControls.js';
    import { OrbitControls } from './js/controls/OrbitControls.js';

    let scene, camera, renderer;
    let controls, orbitControls;
    let coins = [];
    let coinCount = 0;
    let moveSpeed = 0.1; // początkowa prędkość ruchu
    let gameStarted = false;
    let keys = {};

    // Wykrycie urządzenia dotykowego
    const isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

    init();
    animate();

    function init() {
      // Utwórz scenę i kamerę
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x87ceeb); // niebieskie niebo

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 1.6, 5);

      // Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Oświetlenie – ambient i directional
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      directionalLight.position.set(5, 10, 7.5);
      scene.add(directionalLight);

      // Teren – zielona płaszczyzna
      const planeGeometry = new THREE.PlaneGeometry(200, 200);
      const planeMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
      const plane = new THREE.Mesh(planeGeometry, planeMaterial);
      plane.rotation.x = -Math.PI / 2;
      scene.add(plane);

      // Utwórz 20 monet rozmieszczonych losowo
      for (let i = 0; i < 20; i++) {
        const coin = createCoin();
        coin.position.set(
          Math.random() * 40 - 20,
          0.5,
          Math.random() * 40 - 20
        );
        scene.add(coin);
        coins.push(coin);
      }

      // Ustaw sterowanie w zależności od urządzenia
      if (!isMobile) {
        // Na komputerze: PointerLockControls
        controls = new PointerLockControls(camera, document.body);
        document.addEventListener('click', () => {
          controls.lock();
        });
        document.addEventListener('keydown', onKeyDown);
        document.addEventListener('keyup', onKeyUp);
      } else {
        // Na urządzeniach dotykowych: OrbitControls
        orbitControls = new OrbitControls(camera, renderer.domElement);
        orbitControls.enablePan = false;
        orbitControls.enableZoom = false;
      }

      window.addEventListener('resize', onWindowResize, false);

      // Obsługa przycisków menu i sklepu
      document.getElementById('startButton').addEventListener('click', startGame);
      document.getElementById('shopButton').addEventListener('click', openShop);
      document.getElementById('backButton').addEventListener('click', closeShop);
      document.getElementById('buySpeed').addEventListener('click', buySpeedUpgrade);
    }

    // Funkcja tworząca monetę – CylinderGeometry z 64 segmentami, MeshStandardMaterial
    function createCoin() {
      const geometry = new THREE.CylinderGeometry(0.5, 0.5, 0.1, 64);
      const material = new THREE.MeshStandardMaterial({
        color: 0xffd700,
        metalness: 1,
        roughness: 0.3
      });
      return new THREE.Mesh(geometry, material);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // Obsługa klawiatury (dla komputerów)
    function onKeyDown(event) {
      keys[event.code] = true;
    }
    function onKeyUp(event) {
      keys[event.code] = false;
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    function startGame() {
      document.getElementById('menu').style.display = 'none';
      gameStarted = true;
      if (!isMobile && controls) {
        controls.lock();
      }
    }

    function updateHUD() {
      document.getElementById('hud').innerText = 'Monety: ' + coinCount;
    }

    function openShop() {
      document.getElementById('menu').style.display = 'none';
      document.getElementById('shop').style.display = 'flex';
    }
    function closeShop() {
      document.getElementById('shop').style.display = 'none';
      document.getElementById('menu').style.display = 'flex';
    }
    function buySpeedUpgrade() {
      if (coinCount >= 5) {
        coinCount -= 5;
        moveSpeed += 0.05;
        updateHUD();
        document.getElementById('shopMessage').innerText = 'Ulepszono prędkość!';
      } else {
        document.getElementById('shopMessage').innerText = 'Za mało monet!';
      }
    }
  </script>
</body>
</html>
